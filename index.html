<!DOCTYPE html>
<html>
<head>
  <title>The Aburgerbay chat</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; margin: 0; padding: 0; }
    #chat-container { width: 90%; max-width: 600px; margin: auto; padding: 10px; background: white; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    #messages { list-style: none; padding: 0; margin: 0; max-height: 400px; overflow-y: auto; }
    #messages li { padding: 5px 10px; border-bottom: 1px solid #ddd; }
    #messages li.private { background: #ffe5e5; }
    form { display: flex; margin-top: 10px; gap: 5px; }
    input, button { padding: 8px; border: 1px solid #ccc; border-radius: 5px; }
    button { background: #4CAF50; color: white; cursor: pointer; }
    button:hover { background: #45a049; }
    #username-container { display: flex; gap: 5px; margin-bottom: 10px; }
    #typing { font-size: 0.9em; color: gray; margin-top: 5px; min-height: 18px; }
  </style>
</head>
<body>

<div id="chat-container">
  <h2>Cool Chat App</h2>

  <!-- Username setting -->
  <div id="username-container">
    <input id="username" placeholder="Enter username" />
    <button id="set-username">Set</button>
  </div>

  <!-- Messages -->
  <ul id="messages"></ul>
  <div id="typing"></div>

  <!-- Chat form -->
  <form id="form">
    <input id="m" autocomplete="off" placeholder="Type a message" />
    <input id="recipient" placeholder="Recipient (optional)" />
    <button>Send</button>
  </form>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
  const socket = io();
  const messages = document.getElementById('messages');
  const form = document.getElementById('form');
  const input = document.getElementById('m');
  const recipientInput = document.getElementById('recipient');
  const usernameInput = document.getElementById('username');
  const setUsernameBtn = document.getElementById('set-username');
  const typingDiv = document.getElementById('typing');

  let username = 'Anonymous';
  let typingTimeout;

  // Set username
  setUsernameBtn.onclick = () => {
    username = usernameInput.value.trim() || 'Anonymous';
    socket.emit('set username', username);
    usernameInput.value = '';
  };

  // Display messages
  socket.on('chat message', (msg, id, sender, recipient) => {
    const item = document.createElement('li');
    if (recipient) {
      item.textContent = `(Private) ${sender}: ${msg}`;
      item.classList.add('private');
    } else {
      item.textContent = `${sender}: ${msg}`;
    }
    messages.appendChild(item);
    messages.scrollTop = messages.scrollHeight;
  });

  // Typing events
  input.addEventListener('input', () => {
    socket.emit('typing', username);
    clearTimeout(typingTimeout);
    typingTimeout = setTimeout(() => {
      socket.emit('stop typing', username);
    }, 1000);
  });

  socket.on('display typing', (user) => {
    typingDiv.textContent = `${user} is typing...`;
  });

  socket.on('hide typing', () => {
    typingDiv.textContent = '';
  });

  // Send message
  form.addEventListener('submit', (e) => {
    e.preventDefault();
    if (input.value) {
      socket.emit('chat message', input.value, Date.now().toString(), recipientInput.value || null);
      socket.emit('stop typing', username); // Stop typing when message is sent
      input.value = '';
      recipientInput.value = '';
    }
  });
</script>

</body>
</html>
